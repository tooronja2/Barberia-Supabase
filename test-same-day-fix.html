<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test: Same Day Reservation Fix</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a1a;
            color: #ffffff;
        }
        .test-section {
            background: #2d3748;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .test-pass {
            background: #28a745;
            color: white;
        }
        .test-fail {
            background: #dc3545;
            color: white;
        }
        .calendar-day {
            display: inline-block;
            width: 40px;
            height: 40px;
            line-height: 40px;
            text-align: center;
            margin: 2px;
            border: 1px solid #4a5568;
            border-radius: 4px;
            cursor: pointer;
            background: #4a5568;
        }
        .calendar-day.disabled {
            background: #a0aec0;
            color: #2d3748;
            cursor: not-allowed;
        }
        .calendar-day.current {
            border: 2px solid #f6ad37;
            background: #f6ad37;
            color: #1a1a1a;
            font-weight: bold;
        }
        .hour-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 10px 0;
        }
        .hour-button {
            padding: 8px 12px;
            background: #4a5568;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .hour-button.available {
            background: #28a745;
        }
        .hour-button.filtered {
            background: #dc3545;
        }
    </style>
</head>
<body>
    <h1>üõ†Ô∏è Test: Same Day Reservation Fix</h1>
    
    <div class="test-section">
        <h2>üìÖ Calendar Date Comparison Test</h2>
        <p><strong>Current Date:</strong> <span id="currentDate"></span></p>
        <p><strong>Today Status:</strong> <span id="todayStatus"></span></p>
        
        <h3>Calendar Days:</h3>
        <div id="calendarTest"></div>
    </div>
    
    <div class="test-section">
        <h2>‚è∞ Time Filtering Test</h2>
        <p><strong>Current Time:</strong> <span id="currentTime"></span></p>
        <p><strong>Minimum Time (30min buffer):</strong> <span id="minTime"></span></p>
        
        <h3>All Hours:</h3>
        <div id="allHours" class="hour-list"></div>
        
        <h3>Filtered Hours (Same Day Only):</h3>
        <div id="filteredHours" class="hour-list"></div>
    </div>
    
    <div class="test-section">
        <h2>üß™ Test Results</h2>
        <div id="testResults"></div>
    </div>

    <script type="module">
        // Test the filtering function
        function filterHoursForSameDay(hours, selectedDate) {
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const selectedDateOnly = new Date(selectedDate.getFullYear(), selectedDate.getMonth(), selectedDate.getDate());
            
            // If selected date is not today, return all hours
            if (selectedDateOnly.getTime() !== today.getTime()) {
                return hours;
            }
            
            // For today, filter out past hours and add 30-minute buffer
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            
            // Add 30-minute buffer
            const bufferTime = new Date(now);
            bufferTime.setMinutes(currentMinute + 30);
            
            const minHour = bufferTime.getHours();
            const minMinute = bufferTime.getMinutes();
            
            const filteredHours = hours.filter(time => {
                const [hourStr, minuteStr] = time.split(':');
                const hour = parseInt(hourStr);
                const minute = parseInt(minuteStr);
                
                // Convert to comparable time
                const timeValue = hour * 60 + minute;
                const minTimeValue = minHour * 60 + minMinute;
                
                return timeValue >= minTimeValue;
            });
            
            return filteredHours;
        }

        // Generate test hours
        function generateHours() {
            const hours = [];
            
            // Morning hours: 9:00 - 11:45
            for (let hour = 9; hour < 12; hour++) {
                hours.push(`${hour.toString().padStart(2, '0')}:00`);
                hours.push(`${hour.toString().padStart(2, '0')}:15`);
                hours.push(`${hour.toString().padStart(2, '0')}:30`);
                hours.push(`${hour.toString().padStart(2, '0')}:45`);
            }
            
            // Afternoon hours: 14:00 - 18:45
            for (let hour = 14; hour < 19; hour++) {
                hours.push(`${hour.toString().padStart(2, '0')}:00`);
                hours.push(`${hour.toString().padStart(2, '0')}:15`);
                hours.push(`${hour.toString().padStart(2, '0')}:30`);
                hours.push(`${hour.toString().padStart(2, '0')}:45`);
            }
            
            return hours;
        }

        // Run tests
        function runTests() {
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            
            // Display current date and time
            document.getElementById('currentDate').textContent = now.toLocaleDateString('es-ES');
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('es-ES');
            
            const bufferTime = new Date(now);
            bufferTime.setMinutes(now.getMinutes() + 30);
            document.getElementById('minTime').textContent = bufferTime.toLocaleTimeString('es-ES');
            
            // Test calendar logic
            const testResults = [];
            
            // Test 1: Today should be enabled
            const todayDateOnly = new Date(today.getFullYear(), today.getMonth(), today.getDate());
            const isToday = todayDateOnly.getTime() === today.getTime();
            
            if (isToday) {
                testResults.push({ test: 'Today is correctly identified', pass: true });
                document.getElementById('todayStatus').textContent = '‚úÖ Enabled for selection';
            } else {
                testResults.push({ test: 'Today is correctly identified', pass: false });
                document.getElementById('todayStatus').textContent = '‚ùå Should be enabled';
            }
            
            // Test calendar rendering
            const calendarTest = document.getElementById('calendarTest');
            const today_date = now.getDate();
            
            for (let day = today_date - 2; day <= today_date + 5; day++) {
                if (day > 0) {
                    const testDate = new Date(now.getFullYear(), now.getMonth(), day);
                    const testDateOnly = new Date(testDate.getFullYear(), testDate.getMonth(), testDate.getDate());
                    const isPast = testDateOnly < todayDateOnly;
                    const isCurrent = testDateOnly.getTime() === todayDateOnly.getTime();
                    
                    const dayEl = document.createElement('div');
                    dayEl.className = 'calendar-day';
                    dayEl.textContent = day;
                    
                    if (isPast) {
                        dayEl.classList.add('disabled');
                    }
                    if (isCurrent) {
                        dayEl.classList.add('current');
                    }
                    
                    calendarTest.appendChild(dayEl);
                }
            }
            
            // Test time filtering
            const hours = generateHours();
            const filteredHours = filterHoursForSameDay(hours, today);
            
            // Display all hours
            const allHoursDiv = document.getElementById('allHours');
            hours.forEach(time => {
                const hourEl = document.createElement('button');
                hourEl.className = 'hour-button';
                hourEl.textContent = time;
                allHoursDiv.appendChild(hourEl);
            });
            
            // Display filtered hours
            const filteredHoursDiv = document.getElementById('filteredHours');
            hours.forEach(time => {
                const hourEl = document.createElement('button');
                hourEl.className = 'hour-button';
                hourEl.textContent = time;
                
                if (filteredHours.includes(time)) {
                    hourEl.classList.add('available');
                } else {
                    hourEl.classList.add('filtered');
                }
                
                filteredHoursDiv.appendChild(hourEl);
            });
            
            // Test 2: Hours should be filtered correctly
            const hasFilteredHours = filteredHours.length < hours.length;
            testResults.push({ 
                test: 'Hours are filtered for same-day', 
                pass: hasFilteredHours,
                details: `${filteredHours.length}/${hours.length} hours available`
            });
            
            // Test 3: No past hours should be available
            const currentTimeValue = now.getHours() * 60 + now.getMinutes() + 30;
            const hasPastHours = filteredHours.some(time => {
                const [h, m] = time.split(':').map(Number);
                return (h * 60 + m) < currentTimeValue;
            });
            
            testResults.push({ 
                test: 'No past hours in filtered list', 
                pass: !hasPastHours,
                details: hasPastHours ? 'Found past hours!' : 'All hours are future'
            });
            
            // Display results
            const resultsDiv = document.getElementById('testResults');
            testResults.forEach(result => {
                const resultEl = document.createElement('div');
                resultEl.className = `test-result ${result.pass ? 'test-pass' : 'test-fail'}`;
                resultEl.innerHTML = `
                    <strong>${result.test}:</strong> ${result.pass ? '‚úÖ PASS' : '‚ùå FAIL'}
                    ${result.details ? `<br><small>${result.details}</small>` : ''}
                `;
                resultsDiv.appendChild(resultEl);
            });
        }

        // Run tests when page loads
        runTests();
    </script>
</body>
</html>