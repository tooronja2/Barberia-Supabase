<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Steps - Barber√≠a Central</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .debug-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            background-color: #1a202c;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #f6ad37;
            z-index: 9999;
        }
        .debug-panel button {
            margin: 5px;
            padding: 5px 10px;
            background-color: #f6ad37;
            color: #2d3748;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .debug-console {
            background-color: #1a202c;
            color: #51cf66;
            padding: 10px;
            border-radius: 5px;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="nav-container">
            <div class="logo">BARBER√çA CENTRAL - DEBUG</div>
        </div>
    </header>

    <!-- Debug Panel -->
    <div class="debug-panel">
        <h4 style="margin: 0 0 10px 0; color: #f6ad37;">üîß Debug Navigation</h4>
        <button onclick="testGoToStep(1)">Paso 1</button>
        <button onclick="testGoToStep(2)">Paso 2</button>
        <button onclick="testGoToStep(3)">Paso 3</button>
        <button onclick="testGoToStep(4)">Paso 4</button>
        <button onclick="testGoToStep(5)">Paso 5</button>
        <button onclick="testGoToStep(6)">Paso 6</button>
        <br>
        <button onclick="testSelectService()">Test Servicio</button>
        <button onclick="testSelectBarber()">Test Barbero</button>
        <button onclick="clearDebugConsole()">Clear</button>
        <div class="debug-console" id="debugConsole"></div>
    </div>

    <!-- Reservation Container -->
    <div class="reservation-container">
        <h1 style="text-align: center; color: #f6ad37; margin-bottom: 2rem;">DEBUG - Reservar Turno</h1>
        
        <!-- Progress Indicator -->
        <div class="progress-indicator">
            <div class="progress-step active" data-step="1">1</div>
            <div class="progress-step" data-step="2">2</div>
            <div class="progress-step" data-step="3">3</div>
            <div class="progress-step" data-step="4">4</div>
            <div class="progress-step" data-step="5">5</div>
            <div class="progress-step" data-step="6">6</div>
        </div>

        <!-- Step 1: Service Selection -->
        <div class="step-container active" data-step="1">
            <h2 class="step-title">Paso 1 - Selecciona tu Servicio</h2>
            <div class="service-grid" id="serviceSelection">
                <div class="service-card-reservation" data-service-id="1">
                    <h3>Corte de barba</h3>
                    <p>Perfilado profesional</p>
                    <div class="service-price">$6,500</div>
                </div>
                <div class="service-card-reservation" data-service-id="2">
                    <h3>Corte de pelo</h3>
                    <p>Corte personalizado</p>
                    <div class="service-price">$8,500</div>
                </div>
            </div>
            <div class="step-navigation">
                <button class="step-button" disabled>Anterior</button>
                <button class="step-button" id="nextStep1" disabled>Siguiente</button>
            </div>
        </div>

        <!-- Step 2: Barber Selection -->
        <div class="step-container" data-step="2">
            <h2 class="step-title">Paso 2 - Selecciona tu Barbero</h2>
            <div class="barber-grid" id="barberSelection">
                <div class="barber-card" data-barber-id="1">
                    <div class="barber-photo">H</div>
                    <h3>H√©ctor Medina</h3>
                    <p>Corte y barba cl√°sico</p>
                </div>
                <div class="barber-card" data-barber-id="2">
                    <div class="barber-photo">L</div>
                    <h3>Lucas Peralta</h3>
                    <p>Estilos modernos</p>
                </div>
            </div>
            <div class="step-navigation">
                <button class="step-button" id="prevStep2">Anterior</button>
                <button class="step-button" id="nextStep2" disabled>Siguiente</button>
            </div>
        </div>

        <!-- Step 3: Date Selection -->
        <div class="step-container" data-step="3">
            <h2 class="step-title">Paso 3 - Selecciona la Fecha</h2>
            <p>Calendario aparecer√≠a aqu√≠...</p>
            <div class="step-navigation">
                <button class="step-button" id="prevStep3">Anterior</button>
                <button class="step-button" id="nextStep3" disabled>Siguiente</button>
            </div>
        </div>

        <!-- Step 4: Time Selection -->
        <div class="step-container" data-step="4">
            <h2 class="step-title">Paso 4 - Selecciona la Hora</h2>
            <p>Horarios aparecer√≠an aqu√≠...</p>
            <div class="step-navigation">
                <button class="step-button" id="prevStep4">Anterior</button>
                <button class="step-button" id="nextStep4" disabled>Siguiente</button>
            </div>
        </div>

        <!-- Step 5: Customer Details -->
        <div class="step-container" data-step="5">
            <h2 class="step-title">Paso 5 - Completa tus Datos</h2>
            <p>Formulario aparecer√≠a aqu√≠...</p>
            <div class="step-navigation">
                <button class="step-button" id="prevStep5">Anterior</button>
                <button class="step-button" id="nextStep5" disabled>Siguiente</button>
            </div>
        </div>

        <!-- Step 6: Confirmation -->
        <div class="step-container" data-step="6">
            <h2 class="step-title">Paso 6 - Confirma tu Reserva</h2>
            <p>Resumen aparecer√≠a aqu√≠...</p>
            <div class="step-navigation">
                <button class="step-button" id="prevStep6">Anterior</button>
                <button class="step-button" id="confirmReservation">Confirmar Reserva</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { db, supabase } from './js/supabase.js';
        
        // Redirect console to debug panel
        const originalLog = console.log;
        const originalError = console.error;
        
        function addToDebugConsole(message, type = 'log') {
            const debugConsole = document.getElementById('debugConsole');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff6b6b' : '#51cf66';
            debugConsole.innerHTML += `<div style="color: ${color};">[${timestamp}] ${message}</div>`;
            debugConsole.scrollTop = debugConsole.scrollHeight;
        }
        
        console.log = function(...args) {
            addToDebugConsole(args.join(' '), 'log');
            originalLog.apply(console, args);
        };
        
        console.error = function(...args) {
            addToDebugConsole(args.join(' '), 'error');
            originalError.apply(console, args);
        };
        
        // Import the reservation state and functions
        let reservationState = {
            currentStep: 1,
            selectedService: null,
            selectedBarber: null,
            selectedDate: null,
            selectedTime: null,
            customerData: {}
        };
        
        // Test functions
        window.testGoToStep = function(step) {
            console.log(`üß™ TEST: Navegando al paso ${step}`);
            goToStep(step);
        };
        
        window.testSelectService = function() {
            console.log('üß™ TEST: Seleccionando primer servicio');
            const firstService = document.querySelector('.service-card-reservation');
            if (firstService) {
                firstService.click();
            }
        };
        
        window.testSelectBarber = function() {
            console.log('üß™ TEST: Seleccionando primer barbero');
            const firstBarber = document.querySelector('.barber-card');
            if (firstBarber) {
                firstBarber.click();
            }
        };
        
        window.clearDebugConsole = function() {
            document.getElementById('debugConsole').innerHTML = '';
        };
        
        // Go to step function (simplified for testing)
        function goToStep(step) {
            console.log(`üöÄ Navegando al paso ${step}...`);
            
            // Hide all steps
            const allSteps = document.querySelectorAll('.step-container');
            console.log(`üîç Encontrados ${allSteps.length} contenedores de paso`);
            
            allSteps.forEach((container, index) => {
                console.log(`üì¶ Ocultando paso ${container.dataset.step}`);
                container.classList.remove('active');
            });
            
            // Show target step
            const targetStep = document.querySelector(`[data-step="${step}"]`);
            console.log(`üéØ Paso objetivo encontrado:`, targetStep ? 'S√ç' : 'NO');
            
            if (targetStep) {
                targetStep.classList.add('active');
                console.log(`‚úÖ Paso ${step} activado`);
            } else {
                console.error(`‚ùå ERROR: No se encontr√≥ el paso ${step}`);
                return;
            }
            
            // Update progress indicator
            const progressIndicators = document.querySelectorAll('.progress-step');
            progressIndicators.forEach(indicator => {
                indicator.classList.remove('active', 'completed');
            });
            
            for (let i = 1; i < step; i++) {
                const progressIndicator = document.querySelector(`.progress-step[data-step="${i}"]`);
                if (progressIndicator) {
                    progressIndicator.classList.add('completed');
                }
            }
            
            const currentProgressIndicator = document.querySelector(`.progress-step[data-step="${step}"]`);
            if (currentProgressIndicator) {
                currentProgressIndicator.classList.add('active');
            }
            
            reservationState.currentStep = step;
            console.log(`‚úÖ Navegaci√≥n al paso ${step} completada`);
        }
        
        // Setup basic navigation
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Debug Steps page loaded');
            
            // Add basic navigation listeners
            document.getElementById('nextStep1')?.addEventListener('click', () => {
                console.log('üñ±Ô∏è Click en Siguiente Paso 1');
                goToStep(2);
            });
            
            document.getElementById('prevStep2')?.addEventListener('click', () => {
                console.log('üñ±Ô∏è Click en Anterior Paso 2');
                goToStep(1);
            });
            
            document.getElementById('nextStep2')?.addEventListener('click', () => {
                console.log('üñ±Ô∏è Click en Siguiente Paso 2');
                goToStep(3);
            });
            
            // Add service selection
            document.querySelectorAll('.service-card-reservation').forEach(card => {
                card.addEventListener('click', () => {
                    console.log('üõçÔ∏è Servicio seleccionado');
                    document.querySelectorAll('.service-card-reservation').forEach(c => c.classList.remove('selected'));
                    card.classList.add('selected');
                    document.getElementById('nextStep1').disabled = false;
                });
            });
            
            // Add barber selection
            document.querySelectorAll('.barber-card').forEach(card => {
                card.addEventListener('click', () => {
                    console.log('üë§ Barbero seleccionado');
                    document.querySelectorAll('.barber-card').forEach(c => c.classList.remove('selected'));
                    card.classList.add('selected');
                    document.getElementById('nextStep2').disabled = false;
                });
            });
        });
    </script>
</body>
</html>